<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="multimedia/favicon.png">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/
  normalize.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.iconify.design/3/3.1.1/iconify.min.js"></script>
  <style>
    @font-face {
        font-family: 'Moderat';
        src: url('font/Moderat-Bold.ttf') format('truetype');
        font-weight: 700;
        font-style: normal;
    }
    @font-face {
        font-family: 'Moderat';
        src: url('font/Moderat-Medium.ttf') format('truetype');
        font-weight: 500;
        font-style: normal;
    }
    @font-face {
        font-family: 'Moderat';
        src: url('font/Moderat-Regular.ttf') format('truetype');
        font-weight: 400;
        font-style: normal;
    }
    @font-face {
        font-family: 'Moderat';
        src: url('font/Moderat-Light.ttf') format('truetype');
        font-weight: 300;
        font-style: normal;
    }
    * {
      font-family: 'Moderat', sans-serif;
      font-weight: 400;
      font-style: normal;
      user-select: none;
    }
    :root {
      --green: #83DC5A;
      --dark-blue: #203855;
      --blue: #1D54C0;
      --light-blue: #A0C3EA;
      --extra-light-blue: #EDF5FF;
    }
    body {
        cursor: none;
    }
    .hidden {
        display: none;
    }
  </style>
  <title>Tiempos | ibblaverdad</title>
</head>
<body class="bg-black">
  <div id="slider-container" class="h-screen w-screen bg-black">
    <div id="image-slide-container" class="h-full w-full flex items-center justify-center hidden">
      <img id="slider-image" src="" alt="Slider" class="max-h-full max-w-full object-contain">
    </div>
    <div id="song-slide-container" class="h-full w-full relative hidden">
      <video id="song-video" class="absolute top-0 left-0 w-full h-full object-cover" loop muted playsinline></video>
      <audio id="song-audio"></audio>
      <div class="absolute inset-0 flex justify-center items-center z-10">
        <p id="lyric-text" class="text-white text-5xl lg:text-6xl font-bold bg-black px-6 py-3 rounded-lg text-center uppercase"></p>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const slides = [
        { type: 'image', src: 'multimedia/hola.png' },
        { type: 'image', src: 'multimedia/orar.png' },
        {
          type: 'song',
          mp3: 'multimedia/Yo tengo un amigo que me ama.mp3',
          txt: 'multimedia/Yo tengo un amigo que me ama.txt',
          video: 'multimedia/fondo2.mp4',
          lyrics: []
        },
        {
          type: 'song',
          mp3: 'multimedia/Mi amigo es Jesús.mp3',
          txt: 'multimedia/Mi amigo es Jesús.txt',
          video: 'multimedia/fondo1.mp4',
          lyrics: []
        },
        { type: 'image', src: 'multimedia/bye.png' }
      ];
      const maxIndex = slides.length - 1;
      let currentIndex = 0;
      let firstInteraction = true;
      let currentLyricLine = null; 
      const imageSlideContainer = document.getElementById('image-slide-container');
      const sliderImage = document.getElementById('slider-image');
      const songSlideContainer = document.getElementById('song-slide-container');
      const songVideo = document.getElementById('song-video');
      const songAudio = document.getElementById('song-audio');
      const lyricText = document.getElementById('lyric-text');
      function parseLyrics(text) {
        const lines = text.split('\n').slice(1);
        const lyrics = [];
        const regex = /\[(\d{2}):(\d{2})\.(\d{2})\](.*)/;
        for (const line of lines) {
          const match = line.match(regex);
          if (match) {
            const minutes = parseInt(match[1], 10);
            const seconds = parseInt(match[2], 10);
            const hundredths = parseInt(match[3], 10);
            const text = match[4].trim();
            if (text) { 
              const time = (minutes * 60) + seconds + (hundredths / 100);
              lyrics.push({ time, text });
            }
          }
        }
        return lyrics;
      }
      async function loadAllLyrics() {
        const promises = slides.map((slide, index) => {
          if (slide.type === 'song') {
            return fetch(slide.txt)
              .then(response => response.text())
              .then(text => {
                slides[index].lyrics = parseLyrics(text);
              })
              .catch(err => console.error(`Error cargando letra: ${slide.txt}`, err));
          }
          return Promise.resolve();
        });
        await Promise.all(promises);
      }
      const bodyElement = document.documentElement;
      function goFullScreen() {
        if (document.fullscreenElement || document.webkitFullscreenElement) return;
        if (bodyElement.requestFullscreen) bodyElement.requestFullscreen();
        else if (bodyElement.mozRequestFullScreen) bodyElement.mozRequestFullScreen();
        else if (bodyElement.webkitRequestFullscreen) bodyElement.webkitRequestFullscreen();
        else if (bodyElement.msRequestFullscreen) bodyElement.msRequestFullscreen();
      }
      function exitFullScreen() {
        if (!document.fullscreenElement || !document.webkitFullscreenElement) return;
        if (document.exitFullscreen) document.exitFullscreen();
        else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
        else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
        else if (document.msExitFullscreen) document.msExitFullscreen();
      }
      function renderSlide(index) {
        const slide = slides[index];
        songAudio.pause();
        songVideo.pause();
        if (slide.type === 'image') {
          imageSlideContainer.classList.remove('hidden');
          songSlideContainer.classList.add('hidden');
          sliderImage.src = slide.src;
        } else if (slide.type === 'song') {
          songSlideContainer.classList.remove('hidden');
          imageSlideContainer.classList.add('hidden');
          songVideo.src = slide.video;
          songAudio.src = slide.mp3;
          songAudio.currentTime = 0; 
          lyricText.classList.add('hidden');
          currentLyricLine = null;
          songVideo.play();
          songAudio.play();
        }
      }
      function updateLyrics() {
        const currentTime = songAudio.currentTime;
        const currentSlide = slides[currentIndex];
        if (currentSlide.type !== 'song' || songAudio.paused) return;
        const lyrics = currentSlide.lyrics;
        let activeLyric = null;
        for (let i = lyrics.length - 1; i >= 0; i--) {
          if (currentTime >= lyrics[i].time) {
            activeLyric = lyrics[i];
            break;
          }
        }
        if (activeLyric) {
          if (currentTime - activeLyric.time < 6.0) {
            if (currentLyricLine !== activeLyric.text) {
              lyricText.textContent = activeLyric.text;
              lyricText.classList.remove('hidden');
              currentLyricLine = activeLyric.text;
            }
          } else {
            if (currentLyricLine !== null) {
              lyricText.classList.add('hidden');
              currentLyricLine = null;
            }
          }
        } else {
          if (currentLyricLine !== null) {
            lyricText.classList.add('hidden');
            currentLyricLine = null;
          }
        }
      }
      async function initializeApp() {
        await loadAllLyrics();
        songAudio.addEventListener('timeupdate', updateLyrics);
        document.addEventListener('keydown', (e) => {
          if (firstInteraction) {
            goFullScreen();
            firstInteraction = false;
          }
          const currentSlide = slides[currentIndex];
          switch (e.key) {
            case 'ArrowRight':
              currentIndex = Math.min(currentIndex + 1, maxIndex);
              renderSlide(currentIndex);
              break;
            case 'ArrowLeft':
              currentIndex = Math.max(currentIndex - 1, 0);
              renderSlide(currentIndex);
              break;
            case 'ArrowUp':
              goFullScreen();
              break;
            case 'ArrowDown':
              exitFullScreen();
              break;
            case 'Enter':
              if (currentSlide.type === 'song') {
                if (songAudio.paused) {
                  songAudio.play();
                  songVideo.play();
                } else {
                  songAudio.pause();
                  songVideo.pause();
                }
              }
              break;
          }
        });
        document.body.addEventListener('click', () => {
          if (firstInteraction) {
              goFullScreen();
              firstInteraction = false;
          }
        });
        renderSlide(currentIndex);
      }
      initializeApp();
    });
  </script>
</body>
</html>